<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      .hide {
        display: none;
      }
    </style>
  </head>
  <body>
    <div>
      <nav
        class="bg-slate-100 shadow flex justify-between sticky top-0 z-50 place-items-center w-full"
      >
        <div class="flex justify-center">
          <h1 onclick="window.location.href='/'" class="mx-4">CITS3002 Project</h1>
          <button onclick="window.location.href='/logout'" class="ml-4">logout</button>
        </div>
      </nav>
    </div>

    <div class="Quiz-Area flex flex-col justify-center items-center h-[calc(100vh-72px)]">
      <div class="Quiz-Header slide">
        <div class="Question-Area">
          <p>
            This is a question and below are the answers? <br />
            A) <br />
            B) <br />
            C) <br />
            D)
          </p>
        </div>
        <div class="Answer-Area">
          <div class="Text-Answer-Area">
            <textarea class="codeInput border-solid border-2 border-slate-500" rows="8" cols="80"></textarea>
          </div>
        </div>
      </div>
      <div class="Quiz-Bottom">
        <input
          class="bottom-button bg-yellow-300 rounded-md p-2 m-2 pb-2"
          onclick="submitPressed()"
          type="submit"
          name=""
          value="Submit Answer"
        />
        <button id="real-submit" class="text-blue-500" onclick="reload()">
          Next Question
        </button>
        <p class="text-red-700" id="incorrect">Answer incorrect</p>
        <p class="text-green-500" id="correct">Answer Correct</p>
      </div>
    </div>
    <script>
      let qtnArea = document.getElementsByClassName("Question-Area");
      let quizArea = document.getElementsByClassName("Quiz-Area");
      let submitBtn = document.getElementsByClassName("submit-button");
      let textAns = document.getElementsByClassName("codeInput");
      let textAnsArea = document.getElementsByClassName("Text-Answer-Area");
      let radioAnsArea = document.getElementsByClassName("Half-Answer-Area");
      let sumQtnDisplay = document.getElementsByClassName("sumQtnDisplay");
      let sumAnsDisplay = document.getElementsByClassName("sumAnsDisplay");
      let incorrect = document.getElementById("incorrect");
      let real = document.getElementById("real-submit");
      let correct = document.getElementById("correct");
      let answers = "";
      window.addEventListener("load", () => {
        console.log("page loaded");
        incorrect.classList.add("hide");
        correct.classList.add("hide");
        real.classList.add("hide");
      });
      var xhr = new XMLHttpRequest();
      const addAnswer = (question, answer) => {
        ans = `qid=${question}&sans=${answer}&ans=${answer}`;
      };
      xhr.onreadystatechange = () => {
        if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 418) {
          incorrect.classList.remove("hide");
          real.classList.add("hide");
          correct.classList.add("hide");
        } 
        else {
          incorrect.classList.add("hide");
          correct.classList.remove("hide");
          real.classList.remove("hide");
        }
      };

      const submit = async (answers) => {
        xhr.open("POST", window.location.href, true);
        xhr.setRequestHeader(
          "Content-Type",
          "application/x-www-form-urlencoded"
        );
        await xhr.send(ans);
      };
      function reload () {
        window.location.reload();
      }
      //function called when the submit button is pressed
      function submitPressed() {
        if (textAns[0].value != "") {
          addAnswer(1, textAns[0].value);
          submit(ans);
        }
      }
    </script>
  </body>
</html>
